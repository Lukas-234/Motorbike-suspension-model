import pandas as pd
import numpy as np
import itertools
import matplotlib.pyplot as plt
from scipy import interpolate

#velocity needed and plot x value as a function of time rather than meters

# https://www.sciencing.com/convert-distances-degrees-meters-7858322/ source for converting lattitude to longitude
#Compare with https://www.gpsvisualizer.com/elevation as it will give difference in meters

# read the excel file with the data
df = pd.read_excel(r"C:\Users\lukas\OneDrive\Desktop\Work\Third Year\computational methods\Group Project\Data\Liberton Road (A Road).xlsx")
#Longitude = pd.read_excel(r"C:\Users\lukas\OneDrive\Desktop\Work\Third Year\computational methods\Group Project\Data\A701 Liberton road .xlsx", usecols="C")
#Altitude = pd.read_excel(r"C:\Users\lukas\OneDrive\Desktop\Work\Third Year\computational methods\Group Project\Data\A701 Liberton road .xlsx", usecols="D")

#have a velocity
velocity = 17.886 # this is 40mph in m/s
velocity = int(velocity)
print(type(velocity)), "type of velocity"

# Get all the data from the excel files
Lattitude = df.iloc[:, 1].values
Longitude = df.iloc[:, 2].values
Altitude = df.iloc[:, 3].values
#print(Lattitude, Longitude, Altitude)

# conversion from degrees to meters
conversion = 111139
Lattitude = np.array(Lattitude)*conversion
Longitude = np.array(Longitude) * conversion

lengthlist = len(Lattitude)
lengthloop = lengthlist -1

Latdifflist = []

for i in range (0,lengthloop):
    Latdiff = Lattitude[i] - Lattitude[i+1]
    #print(Latdiff)
    Latdifflist.append(Latdiff**2)

Latdifflistsq = np.array(Latdifflist)**2
#print(Latdifflistsq, "lattitude difference squared")


Longdifflist = []

for i in range (0,lengthloop):
    Longdiff = Longitude[i] - Longitude[i+1]
    #print("longdiff",Longdiff)
    Longdifflist.append(Longdiff)

Longdifflistsq = np.array(Longdifflist)**2
#print(Longdifflistsq, "longitudinal difference squared")

D2 = Longdifflistsq + Latdifflistsq

#print(D2, "Difference squared")
D = np.array(D2)**0.5

#print (D, "difference in meters")

#To go from meters to seconds divide the meters by speed

#Distance travelled
Dtotal = np.array(list(itertools.accumulate(D)))

#print(Dtotal, "Distance total")

multiplier = 1/velocity

Ttotal = []
Ttotal = Dtotal *multiplier

print(Ttotal, "time total")
print(Dtotal, "distance total")
print(len(Ttotal), "length of Ttotal")

#make a new list of Ttotal to have a list of values to plot the interpolated altitude values
Tmax = max(Ttotal)
x_lin = np.linspace(0.023, Tmax, 700)

#remove first altitude value
Altitude = Altitude[1:]

#find the minimum of the altitudes:
def get_min(Altitude):
    res = Altitude[0]
    for i in Altitude[1:]:
        res = min(res, i)
    return res

min_altitude = get_min(Altitude)
print(min_altitude, "min altitude")

# subtract the minimum from all altitude values to get a displacement
displacement = Altitude - min_altitude
print(displacement)

#interpolate
f_lin = interpolate.splrep(Ttotal, displacement, s=5)
displacement_spline_interpolated = interpolate.splev(x_lin,f_lin , der = 0)


plt.plot(x_lin, displacement_spline_interpolated, )
plt.xlabel("Time (s)")
plt.ylabel("Displacement")
plt.grid()
plt.show()
